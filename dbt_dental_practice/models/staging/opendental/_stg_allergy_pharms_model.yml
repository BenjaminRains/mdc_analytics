version: 2

models:
  # =========== ALLERGIES ===========
  # - name: stg_allergy
  #   description: "Patient allergies"
  #   columns:
  #     # Primary Key
  #     - name: allergy_id
  #       description: "Primary key for allergies"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Relationships
  #     - name: allergy_definition_id
  #       description: "Foreign key to allergy definition"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_allergydef')
  #             field: allergy_definition_id
  #     - name: patient_id
  #       description: "Foreign key to patient"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_patient')
  #             field: patient_id
  #
  #     # Allergy Details
  #     - name: reaction_description
  #       description: "Description of allergic reaction"
  #     - name: snomed_reaction_code
  #       description: "SNOMED CT code for reaction"
  #     - name: is_active_flag
  #       description: "Whether allergy is currently active"
  #       tests:
  #         - not_null
  #
  #     # Dates
  #     - name: adverse_reaction_date
  #       description: "Date of adverse reaction"
  #     - name: updated_at
  #       description: "When record was last updated"
  #
  # =========== ALLERGY DEFINITIONS ===========
  # - name: stg_allergydef
  #   description: "Allergy definitions"
  #   columns:
  #     # Primary Key
  #     - name: allergy_definition_id
  #       description: "Primary key for allergy definitions"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Relationships
  #     - name: medication_id
  #       description: "Related medication"
  #       tests:
  #         - relationships:
  #             to: ref('stg_medication')
  #             field: medication_id
  #
  #     # Details
  #     - name: allergy_description
  #       description: "Description of allergy"
  #       tests:
  #         - not_null
  #     - name: unii_code
  #       description: "Unique Ingredient Identifier code"
  #     - name: snomed_type
  #       description: "SNOMED CT type code"
  #
  #     # Status
  #     - name: is_hidden_flag
  #       description: "Whether definition is hidden"
  #       tests:
  #         - not_null
  #
  #     # Metadata
  #     - name: updated_at
  #       description: "When record was last updated"
  #
  # =========== DISEASES ===========
  # - name: stg_disease
  #   description: "Patient diseases and conditions"
  #   columns:
  #     # Primary Key
  #     - name: disease_id
  #       description: "Primary key for diseases"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Relationships
  #     - name: patient_id
  #       description: "Foreign key to patient"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_patient')
  #             field: patient_id
  #     - name: disease_definition_id
  #       description: "Foreign key to disease definition"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_diseasedef')
  #             field: disease_definition_id
  #
  #     # Disease Details
  #     - name: problem_status
  #       description: "Current status of the problem"
  #     - name: snomed_problem_type
  #       description: "SNOMED CT code for problem type"
  #     - name: function_status
  #       description: "Status of patient function related to disease"
  #
  #     # Dates
  #     - name: start_date
  #       description: "When disease was first recorded"
  #     - name: stop_date
  #       description: "When disease was resolved (if applicable)"
  #     - name: updated_at
  #       description: "When record was last updated"
  #
  # - name: stg_diseasedef
  #   description: "Disease definitions and codes"
  #   columns:
  #     # Primary Key
  #     - name: disease_definition_id
  #       description: "Primary key for disease definitions"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Disease Details
  #     - name: disease_name
  #       description: "Name of the disease"
  #       tests:
  #         - not_null
  #     - name: icd9_code
  #       description: "ICD-9 diagnosis code"
  #     - name: snomed_code
  #       description: "SNOMED CT code"
  #     - name: icd10_code
  #       description: "ICD-10 diagnosis code"
  #
  #     # Display Settings
  #     - name: display_order
  #       description: "Order for display in UI"
  #     - name: is_hidden_flag
  #       description: "Whether definition is hidden from normal view"
  #       tests:
  #         - not_null
  #
  #     # Metadata
  #     - name: updated_at
  #       description: "When record was last updated"
  #
  # =========== PHARMACY ===========
  # - name: stg_pharmacy
  #   description: "Pharmacy information and contact details"
  #   columns:
  #     # Primary Key
  #     - name: pharmacy_id
  #       description: "Primary key for pharmacies"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Identification
  #     - name: pharmacy_external_id
  #       description: "External identifier for pharmacy"
  #     - name: store_name
  #       description: "Name of pharmacy store"
  #       tests:
  #         - not_null
  #
  #     # Contact Information
  #     - name: phone_number
  #       description: "Primary phone number"
  #     - name: fax_number
  #       description: "Fax number"
  #
  #     # Address Details
  #     - name: address_line_1
  #       description: "Primary address line"
  #     - name: address_line_2
  #       description: "Secondary address line"
  #     - name: city
  #       description: "City name"
  #     - name: state
  #       description: "State code"
  #     - name: postal_code
  #       description: "ZIP/Postal code"
  #
  #     # Additional Information
  #     - name: pharmacy_notes
  #       description: "Additional notes about pharmacy"
  #
  #     # Metadata
  #     - name: updated_at
  #       description: "When record was last updated"
  #
  # - name: stg_pharmclinic
  #   description: "Mapping between pharmacies and clinics"
  #   columns:
  #     # Primary Key
  #     - name: pharmacy_clinic_id
  #       description: "Primary key for pharmacy-clinic relationship"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Relationships
  #     - name: pharmacy_id
  #       description: "Foreign key to pharmacy"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_pharmacy')
  #             field: pharmacy_id
  #     - name: clinic_id
  #       description: "Foreign key to clinic"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_clinic')
  #             field: clinic_id
  #
  # =========== PRESCRIPTIONS ===========
  # - name: stg_rxdef
  #   description: "Prescription definitions and standard instructions"
  #   columns:
  #     # Primary Key
  #     - name: prescription_definition_id
  #       description: "Primary key for prescription definitions"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Drug Information
  #     - name: drug_name
  #       description: "Name of medication"
  #       tests:
  #         - not_null
  #     - name: rx_cui_code
  #       description: "RxNorm Concept Unique Identifier"
  #
  #     # Prescription Details
  #     - name: sig_instructions
  #       description: "Standard signatura (directions for use)"
  #     - name: dispense_instructions
  #       description: "Standard dispensing instructions"
  #     - name: refill_instructions
  #       description: "Standard refill instructions"
  #
  #     # Status Flags
  #     - name: is_controlled_substance_flag
  #       description: "Whether medication is a controlled substance"
  #       tests:
  #         - not_null
  #     - name: is_procedure_required_flag
  #       description: "Whether procedure is required for prescription"
  #       tests:
  #         - not_null
  #
  #     # Instructions
  #     - name: prescriber_notes
  #       description: "Standard notes for prescriber"
  #     - name: patient_instructions
  #       description: "Standard instructions for patient"
  #
  # - name: stg_rxnorm
  #   description: "RxNorm medication codes and descriptions"
  #   columns:
  #     # Primary Key
  #     - name: rxnorm_id
  #       description: "Primary key for RxNorm entries"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Drug Identifiers
  #     - name: rx_cui_code
  #       description: "RxNorm Concept Unique Identifier"
  #       tests:
  #         - not_null
  #     - name: mmsl_code
  #       description: "Master Medicinal Substance List code"
  #
  #     # Drug Information
  #     - name: drug_description
  #       description: "Description of medication"
  #       tests:
  #         - not_null
  #
  # - name: stg_rxpat
  #   description: "Patient prescriptions"
  #   columns:
  #     # Primary Key
  #     - name: prescription_id
  #       description: "Primary key for prescriptions"
  #       tests:
  #         - unique
  #         - not_null
  #
  #     # Relationships
  #     - name: patient_id
  #       description: "Foreign key to patient"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_patient')
  #             field: patient_id
  #     - name: provider_id
  #       description: "Foreign key to prescribing provider"
  #       tests:
  #         - not_null
  #         - relationships:
  #             to: ref('stg_provider')
  #             field: provider_id
  #     - name: pharmacy_id
  #       description: "Foreign key to pharmacy"
  #       tests:
  #         - relationships:
  #             to: ref('stg_pharmacy')
  #             field: pharmacy_id
  #     - name: clinic_id
  #       description: "Foreign key to clinic"
  #       tests:
  #         - relationships:
  #             to: ref('stg_clinic')
  #             field: clinic_id
  #     - name: user_id
  #       description: "Foreign key to user"
  #       tests:
  #         - relationships:
  #             to: ref('stg_userod')
  #             field: user_id
  #     - name: procedure_id
  #       description: "Foreign key to procedure"
  #       tests:
  #         - relationships:
  #             to: ref('stg_procedurelog')
  #             field: procedure_id
  #
  #     # Prescription Details
  #     - name: drug_name
  #       description: "Name of prescribed medication"
  #       tests:
  #         - not_null
  #     - name: sig_instructions
  #       description: "Signatura (directions for use)"
  #     - name: dispense_instructions
  #       description: "Dispensing instructions"
  #     - name: refill_instructions
  #       description: "Refill instructions"
  #     - name: days_supply
  #       description: "Number of days supply"
  #     - name: dosage_code
  #       description: "Code for dosage"
  #     - name: rx_cui_code
  #       description: "RxNorm Concept Unique Identifier"
  #     - name: prescription_type
  #       description: "Type of prescription"
  #
  #     # Status Flags
  #     - name: is_controlled_substance_flag
  #       description: "Whether medication is a controlled substance"
  #       tests:
  #         - not_null
  #     - name: is_procedure_required_flag
  #       description: "Whether procedure is required"
  #       tests:
  #         - not_null
  #     - name: send_status
  #       description: "Status of prescription transmission"
  #
  #     # E-prescribing Information
  #     - name: erx_guid
  #       description: "Electronic prescription GUID"
  #     - name: is_erx_old_flag
  #       description: "Whether e-prescription is old format"
  #     - name: erx_pharmacy_info
  #       description: "Electronic prescription pharmacy information"
  #
  #     # Dates
  #     - name: prescription_date
  #       description: "Date prescription was written"
  #       tests:
  #         - not_null
  #     - name: updated_at
  #       description: "When record was last updated"
