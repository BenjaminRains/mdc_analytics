version: 2

models:
  - name: stg_patient
    description: "Standardized patient information from OpenDental"
    columns:
      - name: patient_id
        description: "Primary key for patient records"
        tests:
          - unique
          - not_null
      
      # Relationships
      - name: guarantor_id
        description: "Foreign key to guarantor patient"
      - name: primary_provider_id
        description: "Foreign key to primary provider"
        tests:
          - relationships:
              to: ref('stg_provider')
              field: provider_id
      - name: secondary_provider_id
        description: "Foreign key to secondary provider"
        tests:
          - relationships:
              to: ref('stg_provider')
              field: provider_id
      - name: clinic_id
        description: "Foreign key to clinic"
      - name: fee_schedule_id
        description: "Foreign key to fee schedule"
        tests:
          - relationships:
              to: ref('stg_feesched')
              field: fee_schedule_id
      
      # Demographics (minimal PHI)
      - name: middle_initial
        description: "Patient's middle initial"
      - name: preferred_name
        description: "Patient's preferred name"
      - name: gender
        description: "Patient's gender"
      - name: language
        description: "Patient's preferred language"
      
      # Status and Classification
      - name: patient_status
        description: "Current status of the patient"
      - name: position_code
        description: "Patient position classification"
      - name: student_status
        description: "Patient's student status if applicable"
      - name: urgency
        description: "Patient urgency classification"
      - name: premedication_required
        description: "Indicates if patient requires premedication"
      
      # Contact Preferences
      - name: preferred_confirmation_method
        description: "Patient's preferred method for appointment confirmations"
      - name: preferred_contact_method
        description: "Patient's preferred method for general contact"
      - name: preferred_recall_method
        description: "Patient's preferred method for recall notifications"
      - name: text_messaging_consent
        description: "Indicates if patient has consented to text messaging"
      - name: prefer_confidential_contact
        description: "Indicates if patient requires confidential contact"
      
      # Financial Information
      - name: estimated_balance
        description: "Estimated current balance"
      - name: total_balance
        description: "Total outstanding balance"
      - name: balance_0_30_days
        description: "Balance aged 0-30 days"
      - name: balance_31_60_days
        description: "Balance aged 31-60 days"
      - name: balance_61_90_days
        description: "Balance aged 61-90 days"
      - name: balance_over_90_days
        description: "Balance aged over 90 days"
      - name: insurance_estimate
        description: "Estimated insurance portion"
      - name: payment_plan_due
        description: "Amount due under payment plan"
      - name: has_insurance_flag
        description: "Indicates if patient has insurance"
      - name: billing_cycle_day
        description: "Day of month for billing cycle"
      
      # Dates
      - name: birth_date
        description: "Patient's date of birth"
      - name: age
        description: "Calculated age of patient"
      - name: first_visit_date
        description: "Date of patient's first visit"
      - name: deceased_datetime
        description: "Date and time of death if applicable"
      - name: admit_date
        description: "Date patient was admitted"
      
      # Scheduling Preferences
      - name: schedule_not_before_time
        description: "Earliest preferred appointment time"
      - name: schedule_not_after_time
        description: "Latest preferred appointment time"
      - name: preferred_day_of_week
        description: "Preferred day for appointments"
      - name: ask_to_arrive_early_minutes
        description: "Minutes patient should arrive before appointment"
      
      # Metadata
      - name: created_at
        description: "When the patient record was created"
        tests:
          - not_null
      - name: updated_at
        description: "When the patient record was last updated"
      - name: created_by_user_id
        description: "User who created the patient record"
      - name: planned_treatment_complete
        description: "Indicates if planned treatment is complete"